# 画布性能优化分析

## 发现的性能问题

### 1. ⚠️ Supabase 客户端频繁重建
**问题**: `useSupabase` hook 每次 session 变化都会重新创建客户端
**影响**: 
- 不必要的对象创建
- 可能导致连接重建
- 内存占用增加

### 2. ⚠️ 画布元素过度渲染
**问题**: 每个元素都是独立的 div，大量元素时渲染慢
**影响**:
- 100+ 元素时明显卡顿
- DOM 节点过多
- 重绘/重排开销大

### 3. ⚠️ 没有虚拟化
**问题**: 所有元素都渲染，即使不在视口内
**影响**:
- 画布外的元素也在渲染
- 浪费 CPU/GPU 资源

### 4. ⚠️ 实时保存频繁触发
**问题**: 每次元素变化都触发 2 秒延迟保存
**影响**:
- 拖动时频繁触发保存逻辑
- 不必要的状态更新

## 优化方案

### 方案 1: 优化 Supabase 客户端创建 ✅ (立即实施)
使用 useMemo 缓存客户端，只在 token 变化时重建

### 方案 2: 添加加载骨架屏 ✅ (立即实施)
显示加载状态，改善用户体验

### 方案 3: 使用 React.memo 优化元素渲染 (中期)
避免不必要的元素重渲染

### 方案 4: 实现虚拟化渲染 (长期)
只渲染视口内的元素

### 方案 5: 使用 Canvas/WebGL 渲染 (长期)
对于大量元素，使用 Canvas 代替 DOM

## 立即可实施的优化
